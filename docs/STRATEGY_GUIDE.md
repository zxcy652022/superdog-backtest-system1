# BiGe 幣哥雙均線策略指南

## 策略版本對照表

| 版本 | 名稱 | 進場邏輯 | 程式檔案 | 狀態 |
|------|------|----------|----------|------|
| v1 | 回踩進場策略 | MA20/MA60 趨勢 + 回踩進場 | `multi_runner.py` | **實盤運行中** |
| v2 | 均線糾纏突破策略 | 6均線糾纏 + 放量突破 | `shadow_runner.py` | 影子測試中 |

---

## 策略 v1：回踩進場策略

### 進場條件

**做多 (Long)**
1. 趨勢確認：`avg20 > avg60` 且差距 > 3%
2. 回踩判斷：價格接近 MA20（容許 1.8%）
3. 未跌破：`low > MA20 * (1 - 2%)`
4. 收盤確認：`close > MA20`

**做空 (Short)**
1. 趨勢確認：`avg20 < avg60` 且差距 > 3%
2. 反彈判斷：價格接近 MA20（容許 1.8%）
3. 未突破：`high < MA20 * (1 + 2%)`
4. 收盤確認：`close < MA20`

### 出場條件

1. **追蹤止損**：MA20 動態追蹤（2% buffer）
2. **確認止損**：連續 10 根 K 線跌破/突破止損位
3. **緊急止損**：單根 K 線跌破 MA20 超過 3.5 倍 ATR

### 加倉條件

1. 已盈利 > 3%
2. 距離上次加倉 > 6 根 K 線（24 小時）
3. 回踩 MA20 附近
4. 未跌破止損位
5. 最多加倉 3 次

---

## 策略 v2：均線糾纏突破策略

### 進場條件

**做多 (Long)**
1. 均線糾纏：6 條均線離散度 < 5%，持續 8 根以上
2. 趨勢方向：MA20 > MA60
3. 放量確認：成交量 > 20 日均量的 2 倍
4. 實體突破：K 線實體 > 1.5%
5. 站穩確認：連續 2 根 K 線收在 MA20 上方
6. MACD 確認：MACD 柱狀 > 0 或動能向上

**做空 (Short)**
1. 均線糾纏：6 條均線離散度 < 5%，持續 8 根以上
2. 完整下跌趨勢：`avg20 < avg60 < avg120`
3. 放量確認：成交量 > 20 日均量的 2 倍
4. 實體突破：K 線實體 < -1.5%
5. 站穩確認：連續 2 根 K 線收在 MA20 下方
6. RSI 過濾：RSI < 40
7. MACD 確認：MACD 柱狀 < 0 或動能向下

### 出場條件

1. **動態止損**：爆倉距離的 70%（隨槓桿變化）
2. **趨勢反轉**：連續 10 根 K 線跌破/突破 MA20
3. **緊急止損**：同 v1

### 動態槓桿

根據累計獲利自動調整槓桿：

| 累計獲利 | 槓桿 |
|----------|------|
| < 4% | 初始槓桿（最高 25x）|
| 4% ~ 9% | 20x |
| 9% ~ 16% | 15x |
| 16% ~ 31% | 10x |
| 31% ~ 64% | 5x |
| 64% ~ 100% | 3x |
| > 100% | 2x |

---

## 策略對比

| 項目 | v1 回踩策略 | v2 糾纏突破策略 |
|------|-------------|-----------------|
| 進場頻率 | 較高 | 較低（需要糾纏形態）|
| 做空條件 | 寬鬆 | 嚴格（需要完整下跌趨勢）|
| 止損方式 | 固定追蹤 | 動態（隨槓桿變化）|
| 槓桿 | 固定 | 動態遞減 |
| 適合行情 | 趨勢延續 | 盤整突破 |

---

## 程式架構

```
live/
├── multi_runner.py     # v1 策略實盤（主要）
├── shadow_runner.py    # v2 策略影子測試
├── runner.py           # 已棄用，請用 multi_runner.py
├── binance_broker.py   # 幣安 API 封裝
├── notifier.py         # Telegram 通知
└── trade_logger.py     # 交易日誌

config/
└── production_phase1.py  # 實盤配置 v2.3
```

---

## 使用方式

### 實盤運行（v1 策略）
```bash
python -m live.multi_runner
```

### 影子測試（v2 策略）
```bash
python -m live.shadow_runner

# 啟用 Telegram 通知
python -m live.shadow_runner --notify
```

### 查看影子訊號
```bash
cat data/shadow_signals.json | jq
```

---

## 配置參數說明

詳見 `config/production_phase1.py`

| 參數 | 說明 | v1 值 | v2 值 |
|------|------|-------|-------|
| leverage | 槓桿 | 10x | 7x（動態）|
| position_size_pct | 倉位比例 | 15% | 25% |
| trend_strength | 趨勢強度 | 3% | 3% |
| stop_loss_confirm_bars | 止損確認 | 10 根 | 10 根 |
| add_position_min_profit | 加倉盈利要求 | 3% | 3% |
| cluster_threshold | 糾纏閾值 | N/A | 5% |
| min_cluster_bars | 糾纏持續 | N/A | 8 根 |

---

## 版本歷史

### multi_runner.py
- v1.0.0: 初始版本
- v1.0.1: 修復 trend_strength 過濾缺失
- v1.0.2: 新增 add_position_min_profit 檢查、除以零保護

### shadow_runner.py
- v1.0.0: 初始版本（從 multi_runner 架構衍生）
- v1.0.1: 新增 add_position_min_profit 檢查、狀態完整重置
